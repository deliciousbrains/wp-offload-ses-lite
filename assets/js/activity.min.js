!function(o,a){function n(e){if(void 0===e)return!1;o(".wposes-notice").remove(),o("#tab-activity").prepend(e),o(".notice-dismiss").on("click",function(e){o(".wposes-notice").remove()})}var s={modalContainer:".wposes-view-email-prompt",modalOpen:!1,modalShown:!1,showPrompt:function(){a.setDismissibleState(!0),a.open(this.modalContainer,!1,"wposes-view-email-modal")},hidePrompt:function(){a.setDismissibleState(!0),a.close()},getEmail:function(e){o.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:{wposes_activity_nonce:o("#wposes_activity_nonce").val(),action:"wposes_get_email",email_id:e},error:function(e,t,a){alert("error"+a)},success:function(e,t,a){s.showPrompt(),o(".wposes-view-email-prompt").html(e.data)}})}},l={modalContainer:".wposes-delete-email-prompt",modalOpen:!1,modalShown:!1,showPrompt:function(e,t){a.setDismissibleState(!0),a.open(this.modalContainer,!1,"wposes-delete-email-modal"),"-1"===e?(o(".wposes-delete-single").hide(),o(".wposes-delete-multiple").show()):(o(".wposes-delete-multiple").hide(),o(".wposes-delete-single").show()),o("#wposes-delete-email-btn").data("email",e),o("#wposes-delete-email-subject").text(t)},hidePrompt:function(){a.setDismissibleState(!0),a.close()}},r={init:function(){var a;o("#tab-activity .tablenav-pages a, #tab-activity .manage-column.sortable a, #tab-activity .manage-column.sorted a").on("click",function(e){e.preventDefault();var t=this.search.substring(1),a={paged:r.__query(t,"paged")||"1",order:r.__query(t,"order")||"desc",orderby:r.__query(t,"orderby")||"date"};r.update(a)}),o("input[name=paged]").on("keyup",function(e){13===e.which&&e.preventDefault();var t={paged:parseInt(o("#tab-activity input[name=paged]").val())||"1",order:o("#tab-activity input[name=order]").val()||"desc",orderby:o("#tab-activity input[name=orderby]").val()||"date"};window.clearTimeout(a),a=window.setTimeout(function(){r.update(t)},500)})},update:function(e){o.ajax({url:ajaxurl,data:o.extend({wposes_activity_nonce:o("#wposes_activity_nonce").val(),action:"wposes_activity_table",paged:parseInt(o("#tab-activity input[name=paged]").val())||"1"},e,r.get_search_data()),success:function(e){var t={};try{t=JSON.parse(e)}catch(e){console.log(e)}t.rows.length&&o("#tab-activity #the-list").html(t.rows),t.column_headers.length&&o("#tab-activity .wp-list-table thead tr, #tab-activity .wp-list-table tfoot tr").html(t.column_headers),t.pagination.bottom.length&&o("#tab-activity .tablenav.top .tablenav-pages").html(o(t.pagination.top).html()),t.pagination.top.length&&o("#tab-activity .tablenav.bottom .tablenav-pages").html(o(t.pagination.bottom).html()),t.views.length&&o("#wposes-views-wrap").html(t.views),t.bulk_actions_result.length&&n(t.bulk_actions_result),r.init()}})},__query:function(e,t){for(var a=e.split("&"),i=0;i<a.length;i++){var o=a[i].split("=");if(o[0]===t)return o[1]}return!1},get_search_data:function(){var e={date:o("#wposes-filter-by-date").val(),subject:o("#wposes-subject-search").val(),recipient:o("#wposes-recipient-search").val(),status:o(".subsubsub a.current").data("status"),bulk_action:o("#bulk-action-selector-top").val(),bulk_selected:[]};return o('input[name="email[]"]:checked').each(function(){e.bulk_selected.push(o(this).val())}),e}};o(document).ready(function(){function t(e){if(!wposes.is_pro)return!1;s.getEmail(e)}function a(e,t){if(!wposes.is_pro)return!1;o.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:{wposes_activity_nonce:o("#wposes_activity_nonce").val(),action:"process_row_action",email_id:t,row_action:e},error:function(e,t,a){alert("error"+a)},success:function(e,t,a){n(e.data),r.update()}})}var e,i;r.init(),e=new URL(location.href).searchParams,(i=e.get("view-email"))&&t(i),(i=e.get("retry-email"))&&a("resend",i),wposes.is_pro||(o("body").on("click",".row-actions span a, #tab-activity .tablenav input, #tab-activity .tablenav select",function(e){e.preventDefault();var t=o(this),a=t.position(),i=o(".wposes-upgrade-helper");i.css({left:a.left-i.width()/2-5+"px",top:a.top+t.height()+9+"px"}),i.toggle(),e.stopPropagation()}),o("#tab-activity .tablenav input, #tab-activity .tablenav select").on("mousedown",function(e){e.preventDefault(),this.blur(),window.focus()})),o("#wposes-activity-form").on("submit",function(e){e.preventDefault(),"delete"===o("#wposes-activity-form #bulk-action-selector-top").val()&&0<o('input[name="email[]"]:checked').length?l.showPrompt("-1",""):r.update({paged:1})}),o("#wposes-views-wrap").on("click","a",function(e){e.preventDefault(),o("#wposes-views-wrap a").removeClass("current"),o(this).addClass("current"),r.update({paged:1})}),o("#tab-activity").on("click",".wposes-view-email",{},function(e){e.preventDefault(),t(o(this).data("email"))}),o("body").on("click",".wposes-resend-email",{},function(e){e.preventDefault(),s.hidePrompt(),a("resend",o(this).data("email"))}),o("body").on("click",".wposes-cancel-email",{},function(e){e.preventDefault(),s.hidePrompt(),a("cancel",o(this).data("email"))}),o("body").on("click",".wposes-delete-email",{},function(e){if(e.preventDefault(),wposes.is_pro){s.hidePrompt();var t=o(this).data("email"),a=o('.wposes-subject-link[data-email="'+t+'"]').text();setTimeout(function(){l.showPrompt(t,a)},200)}}),o("body").on("click","#wposes-delete-email-btn",{},function(e){e.preventDefault(),l.hidePrompt();var t=o("#wposes-delete-email-btn").data("email");"-1"!==t?a("delete",t):r.update({paged:1})})})}(jQuery,wposesModal);