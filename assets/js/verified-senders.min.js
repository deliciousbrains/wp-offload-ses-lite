(function($,wposesModal){wposes.Tools=wposes.Tools?wposes.Tools:{};var wposes_verified_senders={init:function(){var timer;var delay=500;$("#tab-verified-senders .tablenav-pages a, #tab-verified-senders .manage-column.sortable a, #tab-verified-senders .manage-column.sorted a").on("click",(function(e){e.preventDefault();var query=this.search.substring(1);var data={paged:wposes_verified_senders.__query(query,"paged")||"1",order:wposes_verified_senders.__query(query,"order")||"asc",orderby:wposes_verified_senders.__query(query,"orderby")||"sender"};wposes_verified_senders.update(data)}));$("input[name=paged]").on("keyup",(function(e){if(13===e.which){e.preventDefault()}var data={paged:parseInt($("input[name=paged]").val())||"1",order:$("input[name=order]").val()||"asc",orderby:$("input[name=orderby]").val()||"sender"};window.clearTimeout(timer);timer=window.setTimeout((function(){wposes_verified_senders.update(data)}),delay)}))},update:function(data){$.ajax({url:ajaxurl,data:$.extend({wposes_verified_senders_nonce:$("#wposes_verified_senders_nonce").val(),action:"wposes_get_verified_senders_list"},data),success:function(response){var parsed_response={};try{parsed_response=JSON.parse(response)}catch(error){console.log(error)}if(parsed_response.rows.length){$("#tab-verified-senders #the-list").html(parsed_response.rows)}if(parsed_response.column_headers.length){$("#tab-verified-senders .wp-list-table thead tr, #tab-verified-senders .wp-list-table tfoot tr").html(parsed_response.column_headers)}if(parsed_response.pagination.bottom.length){$("#tab-verified-senders .tablenav.top .tablenav-pages").html($(parsed_response.pagination.top).html())}if(parsed_response.pagination.top.length){$("#tab-verified-senders .tablenav.bottom .tablenav-pages").html($(parsed_response.pagination.bottom).html())}wposes_verified_senders.init()}})},__query:function(query,variable){var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]===variable){return pair[1]}}return false}};wposes.Tools.VerifySender={modalContainer:".wposes-verify-sender-prompt",modalOpen:false,showPrompt:function(){wposesModal.setDismissibleState(true);wposesModal.open(this.modalContainer)},hidePrompt:function(){wposesModal.setDismissibleState(true);wposesModal.close()},handlePromptResponse:function(){var sender_field=$("#wposes-verify-domain");var sender_type=$('input[name="sender-type"]:checked').val();if("email"===sender_type){sender_field=$("#wposes-verify-email")}if(!sender_field[0].checkValidity()){sender_field[0].reportValidity();return}var sender=sender_field.val();wposes.Tools.VerifySender.sendVerificationRequest(sender,sender_type)},sendVerificationRequest:function(sender,sender_type){$.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:{_nonce:wposes.nonces.wposes_verify_sender,action:"wposes-verify-sender",sender:sender,sender_type:sender_type},error:function(jqXHR,textStatus,errorThrown){alert("error"+errorThrown)},success:function(data,textStatus,jqXHR){wposes.Tools.VerifySender.handleVerificationResponse(sender,sender_type,data)}})},handleVerificationResponse:function(sender,sender_type,response){wposes_verified_senders.update({});if(!wposes.Tools.VerifySender.modalOpen){wposes.Tools.VerifySender.showPrompt()}if(response.errors){console.log(response.errors);$(".wposes-verification-errors").html(Object.values(response.errors).join(" ")).show()}else if("domain"===sender_type){$("#wposes-update-dns table tbody").empty();for(const token of response.VerificationTokens){$("#wposes-update-dns table tbody").append("<tr>"+"<td><code data-wposes-copy>"+token+"._domainkey."+sender+"</code></td>"+"<td><code data-wposes-copy>"+token+".dkim.amazonses.com</code></td>"+"</tr>")}$("#wposes-verified-sender-form").removeClass().addClass("wposes-update-dns")}else{$("#wposes-verified-sender-form").removeClass().addClass("wposes-confirm-email")}$(".wposes-sender").html(sender)},deleteSenderPrompt:function(sender){if(!wposes.Tools.VerifySender.modalOpen){wposes.Tools.VerifySender.showPrompt();$("#wposes-verified-sender-form").removeClass().addClass("wposes-delete-sender")}$(".wposes-sender").html(sender)},deleteSender:function(){var sender=$("#wposes-delete-sender .wposes-sender").text();$.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:{wposes_verified_senders_nonce:$("#wposes_verified_senders_nonce").val(),action:"wposes_delete_sender",sender:sender},error:function(jqXHR,textStatus,errorThrown){alert("error"+errorThrown)},success:function(data,textStatus,jqXHR){wposes.Tools.VerifySender.hidePrompt();wposes_verified_senders.update({})}})},resetPrompt:function(){$("#wposes-verified-sender-form").removeClass().addClass("wposes-add-sender");$("#wposes-verify-domain, #wposes-verify-email").val("");$("#wposes-domain").prop("checked",true);$(".wposes-show-email, .wposes-verification-errors").hide();$(".wposes-show-domain").show()}};$(document).ready((function(){wposes_verified_senders.init();$("body").on("click","#wposes-refresh-verified-senders",(function(){$(this).addClass("rotate").on("transitionend",(function(){$(this).removeClass("rotate")}));wposes_verified_senders.update({})}));$("body").on("click","#wposes-add-new-verified-sender",(function(event){event.preventDefault();wposes.Tools.VerifySender.showPrompt()}));$("body").on("click",".wposes-remove-sender",(function(event){event.preventDefault();var sender=$(this).data("sender");wposes.Tools.VerifySender.deleteSenderPrompt(sender)}));$("body").on("click",".wposes-view-dns",(function(event){event.preventDefault();var sender=$(this).data("sender");var tokens=$(this).data("tokens");wposes.Tools.VerifySender.handleVerificationResponse(sender,"domain",{VerificationTokens:tokens})}));$("body").on("click",".wposes-resend-verification",(function(event){event.preventDefault();var sender=$(this).data("sender");wposes.Tools.VerifySender.sendVerificationRequest(sender,"email")}));$("body").on("wposes-modal-open",(function(event){wposes.Tools.VerifySender.modalOpen=true;if("function"===typeof document.execCommand){$("#wposes-modal").addClass("wposes-click-to-copy").on("click","[data-wposes-copy]",(function(){wposes.selectText(this);document.execCommand("copy");window.getSelection().removeAllRanges()}))}$("#wposes-verify-sender-btn").on("click",(function(event){event.preventDefault();wposes.Tools.VerifySender.handlePromptResponse()}));$("#wposes-delete-sender-btn").on("click",(function(event){event.preventDefault();wposes.Tools.VerifySender.deleteSender()}));$('#wposes-verified-sender-form input[type="radio"]').on("change",(function(){if("wposes-email"===this.id){$(".wposes-show-domain, .wposes-verification-errors").hide();$(".wposes-show-email").show()}else{$(".wposes-show-email, .wposes-verification-errors").hide();$(".wposes-show-domain").show()}}))}));$("body").on("wposes-modal-close",(function(){wposes.Tools.VerifySender.modalOpen=false;setTimeout((function(){wposes.Tools.VerifySender.resetPrompt()}),151)}))}))})(jQuery,wposesModal);