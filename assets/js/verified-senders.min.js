!function(i,e){wposes.Tools=wposes.Tools?wposes.Tools:{};var n={init:function(){var o;i("#tab-verified-senders .tablenav-pages a, #tab-verified-senders .manage-column.sortable a, #tab-verified-senders .manage-column.sorted a").on("click",function(e){e.preventDefault();var s=this.search.substring(1),o={paged:n.__query(s,"paged")||"1",order:n.__query(s,"order")||"asc",orderby:n.__query(s,"orderby")||"sender"};n.update(o)}),i("input[name=paged]").on("keyup",function(e){13===e.which&&e.preventDefault();var s={paged:parseInt(i("input[name=paged]").val())||"1",order:i("input[name=order]").val()||"asc",orderby:i("input[name=orderby]").val()||"sender"};window.clearTimeout(o),o=window.setTimeout(function(){n.update(s)},500)})},update:function(e){i.ajax({url:ajaxurl,data:i.extend({wposes_verified_senders_nonce:i("#wposes_verified_senders_nonce").val(),action:"wposes_get_verified_senders_list"},e),success:function(e){var s={};try{s=JSON.parse(e)}catch(e){console.log(e)}s.rows.length&&i("#tab-verified-senders #the-list").html(s.rows),s.column_headers.length&&i("#tab-verified-senders .wp-list-table thead tr, #tab-verified-senders .wp-list-table tfoot tr").html(s.column_headers),s.pagination.bottom.length&&i("#tab-verified-senders .tablenav.top .tablenav-pages").html(i(s.pagination.top).html()),s.pagination.top.length&&i("#tab-verified-senders .tablenav.bottom .tablenav-pages").html(i(s.pagination.bottom).html()),n.init()}})},__query:function(e,s){for(var o=e.split("&"),n=0;n<o.length;n++){var r=o[n].split("=");if(r[0]===s)return r[1]}return!1}};wposes.Tools.VerifySender={modalContainer:".wposes-verify-sender-prompt",modalOpen:!1,showPrompt:function(){e.setDismissibleState(!0),e.open(this.modalContainer)},hidePrompt:function(){e.setDismissibleState(!0),e.close()},handlePromptResponse:function(){var e=i("#wposes-verify-domain"),s=i('input[name="sender-type"]:checked').val();if("email"===s&&(e=i("#wposes-verify-email")),e[0].checkValidity()){var o=e.val();wposes.Tools.VerifySender.sendVerificationRequest(o,s)}else e[0].reportValidity()},sendVerificationRequest:function(n,r){i.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:{_nonce:wposes.nonces.wposes_verify_sender,action:"wposes-verify-sender",sender:n,sender_type:r},error:function(e,s,o){alert("error"+o)},success:function(e,s,o){wposes.Tools.VerifySender.handleVerificationResponse(n,r,e)}})},handleVerificationResponse:function(e,s,o){n.update(),wposes.Tools.VerifySender.modalOpen||wposes.Tools.VerifySender.showPrompt(),o.errors?i(".wposes-verification-errors").html(Object.values(o.errors).join(" ")).show():"domain"===s?(i("#wposes-dns-name").html("_amazonses."+e),i("#wposes-dns-value").html(o.VerificationToken),i("#wposes-verified-sender-form").removeClass().addClass("wposes-update-dns")):i("#wposes-verified-sender-form").removeClass().addClass("wposes-confirm-email"),i(".wposes-sender").html(e)},deleteSenderPrompt:function(e){wposes.Tools.VerifySender.modalOpen||(wposes.Tools.VerifySender.showPrompt(),i("#wposes-verified-sender-form").removeClass().addClass("wposes-delete-sender")),i(".wposes-sender").html(e)},deleteSender:function(){var e=i("#wposes-delete-sender .wposes-sender").text();i.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:{wposes_verified_senders_nonce:i("#wposes_verified_senders_nonce").val(),action:"wposes_delete_sender",sender:e},error:function(e,s,o){alert("error"+o)},success:function(e,s,o){wposes.Tools.VerifySender.hidePrompt(),n.update()}})},resetPrompt:function(){i("#wposes-verified-sender-form").removeClass().addClass("wposes-add-sender"),i("#wposes-verify-domain, #wposes-verify-email").val(""),i("#wposes-domain").prop("checked",!0),i(".wposes-show-email, .wposes-verification-errors").hide(),i(".wposes-show-domain").show()}},i(document).ready(function(){n.init(),i("body").on("click","#wposes-refresh-verified-senders",function(){i(this).addClass("rotate").on("transitionend",function(){i(this).removeClass("rotate")}),n.update()}),i("body").on("click","#wposes-add-new-verified-sender",function(e){e.preventDefault(),wposes.Tools.VerifySender.showPrompt()}),i("body").on("click",".wposes-remove-sender",function(e){e.preventDefault();var s=i(this).data("sender");wposes.Tools.VerifySender.deleteSenderPrompt(s)}),i("body").on("click",".wposes-view-dns",function(e){e.preventDefault();var s=i(this).data("sender"),o=i(this).data("token");wposes.Tools.VerifySender.handleVerificationResponse(s,"domain",{VerificationToken:o})}),i("body").on("click",".wposes-resend-verification",function(e){e.preventDefault();var s=i(this).data("sender");wposes.Tools.VerifySender.sendVerificationRequest(s,"email")}),i("body").on("wposes-modal-open",function(e){wposes.Tools.VerifySender.modalOpen=!0,"function"==typeof document.execCommand&&i("#wposes-modal").addClass("wposes-click-to-copy").on("click","[data-wposes-copy]",function(){wposes.selectText(this),document.execCommand("copy"),window.getSelection().removeAllRanges()}),i("#wposes-verify-sender-btn").on("click",function(e){e.preventDefault(),wposes.Tools.VerifySender.handlePromptResponse()}),i("#wposes-delete-sender-btn").on("click",function(e){e.preventDefault(),wposes.Tools.VerifySender.deleteSender()}),i('#wposes-verified-sender-form input[type="radio"]').on("change",function(){"wposes-email"===this.id?(i(".wposes-show-domain, .wposes-verification-errors").hide(),i(".wposes-show-email").show()):(i(".wposes-show-email, .wposes-verification-errors").hide(),i(".wposes-show-domain").show())})}),i("body").on("wposes-modal-close",function(){wposes.Tools.VerifySender.modalOpen=!1,setTimeout(function(){wposes.Tools.VerifySender.resetPrompt()},151)})})}(jQuery,wposesModal);