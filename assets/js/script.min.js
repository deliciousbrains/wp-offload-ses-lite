!function(i){i("body");var o,t=i(".wposes-tab"),e=(i(".wposes-settings"),"general");function s(){"#"+wposes.tabs.defaultTab!==location.hash?(wposes.tabs.toggle(location.hash.replace("#",""),!0),i(document).trigger("wposes.tabRendered",[location.hash.replace("#","")])):location.hash=""}wposes.is_setup||(e="start"),wposes.show_settings_tabs||(e="network-settings"),wposes.tabs={defaultTab:e,toggle:function(e,s){e=wposes.tabs.sanitizeHash(e),t.hide(),(o=i("#tab-"+e)).show(),i(".nav-tab").removeClass("nav-tab-active"),i('a.nav-tab[data-tab="'+e+'"]').addClass("nav-tab-active"),i(".wposes-main").data("tab",e);-1!==i.inArray(e,["network-settings","general","verified-senders","send-test-email","aws-access-keys","licence"])?(i('a.nav-tab[data-tab="settings"]').addClass("nav-tab-active"),i("#wposes-settings-sub-nav").show()):i("#wposes-settings-sub-nav").hide(),s||i(".wposes-updated").removeClass("show"),"support"===e&&wposes.tabs.getDiagnosticInfo()},getDiagnosticInfo:function(){var a=i(".debug-log-textarea");a.html(wposes.strings.get_diagnostic_info);var e={action:"wposes-get-diagnostic-info",_nonce:wposes.nonces.get_diagnostic_info};i.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:e,error:function(e,s,t){a.html(t)},success:function(e,s,t){void 0!==e.success?a.html(e.diagnostic_info):(a.html(wposes.strings.get_diagnostic_info_error),a.append(e.error))}})},sanitizeHash:function(e){return 0===i("#tab-"+e).length&&(e=wposes.tabs.defaultTab),e}},wposes.reloadUpdated=function(){var e=location.pathname+location.search;location.search.match(/[?&]updated=/)||(e+="&updated=1"),e+=location.hash,location.assign(e)};var a=function(){this.$key=t.find('input[name="aws-access-key-id"]'),this.$secret=t.find('input[name="aws-secret-access-key"]'),this.$spinner=t.find("[data-wposes-aws-keys-spinner]"),this.$feedback=t.find("[data-wposes-aws-keys-feedback]")};a.prototype.set=function(){this.sendRequest("set",{"aws-access-key-id":this.$key.val(),"aws-secret-access-key":this.$secret.val()}).done(function(e){e.success&&this.$secret.val(wposes.strings.not_shown_placeholder)}.bind(this))},a.prototype.remove=function(){this.sendRequest("remove").done(function(e){e.success&&(this.$key.val(""),this.$secret.val(""))}.bind(this))},a.prototype.sendRequest=function(e,s){var t={action:"wposes-aws-keys-"+e,_ajax_nonce:wposes.nonces["aws_keys_"+e]};return _.isObject(s)&&(t=_.extend(t,s)),wposes.is_setup&&this.$spinner.addClass("is-active"),i.post(ajaxurl,t).done(function(e){this.$feedback.toggleClass("notice-success",e.success).toggleClass("notice-error",!e.success),!wposes.is_setup&&e.success||e.data&&e.data.message&&this.$feedback.html("<p>"+e.data.message+"</p>").show(),e.success&&wposes.is_setup&&wposes.reloadUpdated()}.bind(this)).always(function(){this.$spinner.removeClass("is-active")}.bind(this))},wposes.AccessKeys=a,wposes.isVerifiedIdentity=function(s){var t=!1;return wposes.verified_senders.forEach(function(e){s.endsWith(e)&&(t=!0)}),t},wposes.selectText=function(e){var s,t;document.body.createTextRange?((s=document.body.createTextRange()).moveToElementText(e),s.select()):window.getSelection&&(t=window.getSelection(),(s=document.createRange()).selectNodeContents(e),t.removeAllRanges(),t.addRange(s))},"function"==typeof document.execCommand&&i(".wposes-main").addClass("wposes-click-to-copy").on("click","[data-wposes-copy]",function(){wposes.selectText(this),document.execCommand("copy"),window.getSelection().removeAllRanges()}),i(document).ready(function(){s(),window.onhashchange=function(e){"function"==typeof history.replaceState&&"#"===location.href.slice(-1)&&history.replaceState({},"",location.href.slice(0,-1)),i("#setting-error-settings_updated").remove(),s()};var e=i(".wposes-main #wposes-settings-sub-nav");i(".wposes-compatibility-notice, div.updated, div.error, div.notice").not(".below-h2, .inline").insertAfter(e),t.on("change",".sub-toggle",function(e){var s=i(this).attr("id");i(".wposes-setting."+s).toggleClass("hide")}),i(".wposes-switch").on("click",function(e){i(this).hasClass("disabled")||function(e){var s=o.find("#"+e),t=s.find("input[type=checkbox]");s.toggleClass("on").find("span").toggleClass("checked");var a=s.find("span.on").hasClass("checked");t.prop("checked",a).trigger("change")}(i(this).attr("id"))}),i("body").on("click","#wposes-send-test-email-btn",function(e){e.preventDefault();var a=i("#tab-send-test-email .spinner"),s=i("#wposes-test-email-address"),o=i("#wposes-test-email-sent"),n=i("#wposes-test-email-error");s[0].checkValidity()?(o.hide(),n.hide(),a.addClass("is-active"),i.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:{action:"wposes-send-test-email",_nonce:wposes.nonces.wposes_send_test_email,email_address:i("#wposes-test-email-address").val()},error:function(e,s,t){i("#tab-send-test-email .spinner").removeClass("is-active"),console.log(e,s,t)},success:function(e,s,t){if(a.removeClass("is-active"),!1===e.success&&void 0!==e.data)return i("#wposes-test-email-error p").text(e.data),void n.show();o.show()}})):s[0].reportValidity()}),i("body").on("click",".general-helper",function(e){e.preventDefault();var s=i(this),t=i(this).next();i(".helper-message").not(t).hide();var a=s.position();t.hasClass("bottom")?t.css({left:a.left-t.width()/2-5+"px",top:a.top+s.height()+9+"px"}):t.css({left:a.left+s.width()+9+"px",top:a.top+s.height()/2-18+"px"}),t.toggle(),e.stopPropagation()}),i("body").on("click",function(){i(".helper-message").hide()}),i(".helper-message").on("click",function(e){e.stopPropagation()}),t.on("click","[data-wposes-toggle-access-keys-form]",function(e){e.preventDefault(),i("#wposes_access_keys").toggle()}),t.on("click","[data-wposes-aws-keys-action]",function(e){e.preventDefault();var s=i(this).data("wposesAwsKeysAction"),t=new a;"function"==typeof t[s]&&t[s]()}),i("#wposes-enable-health-report-wrap").on("click",function(e){i(this).hasClass("on")?(i("#wposes-health-report-sub-settings").show(),"custom"===i('select[name="health-report-recipients"]').val()?i(".wposes-health-report-custom-recipients-container").show():i(".wposes-health-report-custom-recipients-container").hide()):i("#wposes-health-report-sub-settings").hide()}),i('select[name="health-report-recipients"]').on("change",function(e){"custom"===i(this).val()?(i(".wposes-health-report-custom-recipients-container").show(),i('input[name="health-report-custom-recipients"]').attr("required","required")):(i(".wposes-health-report-custom-recipients-container").hide(),i('input[name="health-report-custom-recipients"]').removeAttr("required"))})})}(jQuery);